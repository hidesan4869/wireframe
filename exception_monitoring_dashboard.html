<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>例外ケース監視ダッシュボード - 不動産ポータル管理画面</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f9f9f9;
            color: #2c2c2c;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* ヘッダー */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #2c2c2c;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .header-status {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 14px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #666666;
        }

        .status-dot.critical {
            background: #ffffff;
            animation: blink 1s infinite;
        }

        .status-dot.warning {
            background: #cccccc;
        }

        .status-dot.normal {
            background: #888888;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* メインコンテンツ */
        .main-content {
            flex: 1;
            margin-top: 60px;
            padding: 30px;
            overflow-y: auto;
            max-width: 1600px;
            margin-left: auto;
            margin-right: auto;
        }

        .breadcrumb {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-size: 14px;
            color: #6a6a6a;
        }

        .breadcrumb a {
            color: #6a6a6a;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 600;
            color: #2c2c2c;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #4a4a4a;
            color: white;
        }

        .btn-primary:hover {
            background: #3a3a3a;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #777777;
            color: white;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* アラートバナー */
        .alert-banner {
            background: #f0f0f0;
            border-left: 4px solid #999999;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-icon {
            font-size: 24px;
            animation: pulse 2s infinite;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            color: #333333;
            margin-bottom: 5px;
        }

        .alert-message {
            font-size: 14px;
            color: #555555;
        }

        /* メトリクスグリッド */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: relative;
        }

        .metric-card.critical {
            border-left: 4px solid #999999;
        }

        .metric-card.warning {
            border-left: 4px solid #777777;
        }

        .metric-card.success {
            border-left: 4px solid #666666;
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-title {
            font-size: 14px;
            color: #666666;
            font-weight: 500;
        }

        .metric-trend {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 4px;
            background: #f0f0f0;
            color: #555555;
        }

        .metric-trend.up {
            background: #f5f5f5;
            color: #333333;
        }

        .metric-trend.down {
            background: #e8e8e8;
            color: #444444;
        }

        .metric-number {
            font-size: 36px;
            font-weight: 700;
            color: #2c2c2c;
            margin-bottom: 5px;
        }

        .metric-number.critical {
            color: #555555;
        }

        .metric-number.warning {
            color: #666666;
        }

        .metric-subtitle {
            font-size: 12px;
            color: #7a7a7a;
        }

        /* チャートエリア */
        .chart-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #4a4a4a;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chart-placeholder {
            width: 100%;
            height: 300px;
            background: #f8f8f8;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999999;
            font-size: 16px;
            border: 2px dashed #d0d0d0;
        }

        /* リアルタイムフィード */
        .activity-feed {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .activity-title {
            font-size: 18px;
            font-weight: 600;
            color: #4a4a4a;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .activity-icon.critical {
            background: #f5f5f5;
            color: #333333;
        }

        .activity-icon.warning {
            background: #e8e8e8;
            color: #444444;
        }

        .activity-icon.info {
            background: #f8f8f8;
            color: #555555;
        }

        .activity-content {
            flex: 1;
        }

        .activity-message {
            font-size: 14px;
            color: #2c2c2c;
            margin-bottom: 5px;
            line-height: 1.4;
        }

        .activity-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #7a7a7a;
        }

        /* データテーブル */
        .data-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .table-header {
            padding: 20px 25px;
            background: #f5f5f5;
            border-bottom: 1px solid #d0d0d0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
            color: #4a4a4a;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead th {
            background: #f5f5f5;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #4a4a4a;
            border-bottom: 2px solid #d0d0d0;
            font-size: 13px;
        }

        tbody td {
            padding: 15px;
            border-bottom: 1px solid #e8e8e8;
            font-size: 14px;
            vertical-align: middle;
        }

        tbody tr:hover {
            background: #f9f9f9;
        }

        tbody tr.critical {
            background: #fff5f5;
            border-left: 4px solid #999999;
        }

        tbody tr.warning {
            background: #fafafa;
            border-left: 4px solid #777777;
        }

        /* ステータスバッジ */
        .status-badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: inline-block;
            text-align: center;
            min-width: 100px;
        }

        .status-critical {
            background: #f5f5f5;
            color: #999999;
        }

        .status-warning {
            background: #eeeeee;
            color: #555555;
        }

        .status-normal {
            background: #f0f0f0;
            color: #6a6a6a;
        }

        .status-resolved {
            background: #e8e8e8;
            color: #333333;
        }

        /* 優先度バッジ */
        .priority-badge {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .priority-urgent {
            background: #f8f8f8;
            color: #222222;
        }

        .priority-high {
            background: #f0f0f0;
            color: #333333;
        }

        .priority-medium {
            background: #e8e8e8;
            color: #444444;
        }

        .priority-low {
            background: #e0e0e0;
            color: #555555;
        }

        /* フィルターセクション */
        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            font-size: 12px;
            color: #6a6a6a;
            margin-bottom: 5px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #c0c0c0;
            border-radius: 6px;
            font-size: 14px;
        }

        /* モーダル */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 95%;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            background: #2c2c2c;
            color: white;
            padding: 20px 25px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #d0d0d0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* 自動更新インジケーター */
        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            color: #666666;
        }

        .refresh-indicator {
            width: 12px;
            height: 12px;
            border: 2px solid #e0e0e0;
            border-top: 2px solid #666666;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <header class="header">
            <h1 style="cursor: pointer;" onclick="window.location.href='index.html'">不動産ポータル管理システム</h1>
            <div class="header-status">
                <div class="status-indicator">
                    <div class="status-dot critical"></div>
                    <span>重大: 7件</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot warning"></div>
                    <span>警告: 15件</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot normal"></div>
                    <span>正常: 98.3%</span>
                </div>
            </div>
            <div class="user-info">
                <div class="auto-refresh">
                    <div class="refresh-indicator"></div>
                    <span>自動更新中</span>
                </div>
                <span>田中 太郎さん</span>
                <button class="btn btn-secondary">ログアウト</button>
            </div>
        </header>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <div class="breadcrumb">
                <a href="index.html">ホーム</a> > 
                <a href="exception_approval_rejection.html">例外処理管理</a> > 
                監視ダッシュボード
            </div>

            <div class="page-header">
                <h2 class="page-title">📊 例外ケース監視ダッシュボード</h2>
                <div>
                    <button class="btn btn-secondary" onclick="exportDashboardReport()">レポート出力</button>
                    <button class="btn btn-primary" onclick="configureAlerts()">アラート設定</button>
                </div>
            </div>

            <!-- 緊急アラートバナー -->
            <div class="alert-banner">
                <div class="alert-icon">🚨</div>
                <div class="alert-content">
                    <div class="alert-title">緊急対応が必要な例外ケースが検出されています</div>
                    <div class="alert-message">データ整合性の重大な問題7件と、期限超過の修正要求3件があります。</div>
                </div>
                <div>
                    <button class="btn btn-danger" onclick="viewCriticalIssues()">詳細確認</button>
                </div>
            </div>

            <!-- メトリクス概要 -->
            <div class="metrics-grid">
                <div class="metric-card critical">
                    <div class="metric-header">
                        <span class="metric-title">重大問題</span>
                        <span class="metric-trend up">+2</span>
                    </div>
                    <div class="metric-number critical">7</div>
                    <div class="metric-subtitle">即座に対応が必要</div>
                </div>

                <div class="metric-card warning">
                    <div class="metric-header">
                        <span class="metric-title">修正要求</span>
                        <span class="metric-trend">-3</span>
                    </div>
                    <div class="metric-number warning">15</div>
                    <div class="metric-subtitle">期限内対応が必要</div>
                </div>

                <div class="metric-card warning">
                    <div class="metric-header">
                        <span class="metric-title">期限超過</span>
                        <span class="metric-trend up">+1</span>
                    </div>
                    <div class="metric-number warning">3</div>
                    <div class="metric-subtitle">エスカレーション対象</div>
                </div>

                <div class="metric-card success">
                    <div class="metric-header">
                        <span class="metric-title">処理完了率</span>
                        <span class="metric-trend up">+1.2%</span>
                    </div>
                    <div class="metric-number">87.5%</div>
                    <div class="metric-subtitle">今月の実績</div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">平均解決時間</span>
                        <span class="metric-trend down">-0.8h</span>
                    </div>
                    <div class="metric-number">4.2h</div>
                    <div class="metric-subtitle">過去7日間平均</div>
                </div>

                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">再発率</span>
                        <span class="metric-trend down">-2.1%</span>
                    </div>
                    <div class="metric-number">8.7%</div>
                    <div class="metric-subtitle">同一案件の再問題化</div>
                </div>
            </div>

            <!-- チャートセクション -->
            <div class="chart-section">
                <div class="chart-card">
                    <div class="chart-title">
                        例外ケース発生推移（過去30日間）
                        <select class="filter-select" style="width: auto;">
                            <option value="30">過去30日</option>
                            <option value="7">過去7日</option>
                            <option value="90">過去90日</option>
                        </select>
                    </div>
                    <div class="chart-placeholder">
                        📈 時系列チャート<br>
                        <small>重大問題（赤線）、修正要求（オレンジ線）、期限超過（紫線）の推移</small>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">
                        問題カテゴリ別分布
                        <button class="btn btn-sm btn-secondary" onclick="refreshChart()">更新</button>
                    </div>
                    <div class="chart-placeholder" style="height: 280px;">
                        🥧 円グラフ<br>
                        <small>ステータス不整合 35%<br>
                        金額データ問題 28%<br>
                        承認プロセス 20%<br>
                        書類不備 17%</small>
                    </div>
                </div>
            </div>

            <!-- リアルタイム活動フィード -->
            <div class="activity-feed">
                <div class="activity-title">
                    🔴 リアルタイム監視フィード
                    <div class="auto-refresh">
                        <div class="refresh-indicator"></div>
                        <span>30秒毎更新</span>
                    </div>
                </div>
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon critical">⚠️</div>
                        <div class="activity-content">
                            <div class="activity-message">
                                <strong>REF-089</strong> でデータ整合性の重大な問題を検出しました
                            </div>
                            <div class="activity-meta">
                                <span>2分前</span>
                                <span>データ整合性チェック</span>
                                <span>自動検出</span>
                            </div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon warning">📝</div>
                        <div class="activity-content">
                            <div class="activity-message">
                                <strong>REF-067</strong> の修正期限まで残り6時間です
                            </div>
                            <div class="activity-meta">
                                <span>5分前</span>
                                <span>期限監視</span>
                                <span>田中不動産</span>
                            </div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon info">✅</div>
                        <div class="activity-content">
                            <div class="activity-message">
                                <strong>REF-055</strong> の修正要求が解決されました
                            </div>
                            <div class="activity-meta">
                                <span>12分前</span>
                                <span>問題解決</span>
                                <span>山田建設</span>
                            </div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon critical">🔥</div>
                        <div class="activity-content">
                            <div class="activity-message">
                                <strong>REF-034</strong> が3回目の却下となりました（エスカレーション対象）
                            </div>
                            <div class="activity-meta">
                                <span>18分前</span>
                                <span>承認処理</span>
                                <span>佐藤ハウジング</span>
                            </div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon warning">⏰</div>
                        <div class="activity-content">
                            <div class="activity-message">
                                月次報告の提出期限が明日に迫っています（未提出企業: 3社）
                            </div>
                            <div class="activity-meta">
                                <span>25分前</span>
                                <span>期限監視</span>
                                <span>システム通知</span>
                            </div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon info">🔄</div>
                        <div class="activity-content">
                            <div class="activity-message">
                                <strong>REF-091</strong> の再提出が完了しました
                            </div>
                            <div class="activity-meta">
                                <span>32分前</span>
                                <span>再提出処理</span>
                                <span>鈴木工務店</span>
                            </div>
                        </div>
                    </div>

                    <div class="activity-item">
                        <div class="activity-icon warning">📊</div>
                        <div class="activity-content">
                            <div class="activity-message">
                                データ整合性の定期チェックで15件の警告を検出
                            </div>
                            <div class="activity-meta">
                                <span>1時間前</span>
                                <span>定期チェック</span>
                                <span>自動実行</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- フィルター -->
            <div class="filter-section">
                <div class="filter-row">
                    <div class="filter-group">
                        <label class="filter-label">重要度</label>
                        <select class="filter-select" onchange="applyFilter()">
                            <option value="">全て</option>
                            <option value="critical">重大</option>
                            <option value="warning">警告</option>
                            <option value="info">情報</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">カテゴリ</label>
                        <select class="filter-select" onchange="applyFilter()">
                            <option value="">全て</option>
                            <option value="status">ステータス不整合</option>
                            <option value="amount">金額問題</option>
                            <option value="approval">承認プロセス</option>
                            <option value="document">書類不備</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">企業</label>
                        <select class="filter-select" onchange="applyFilter()">
                            <option value="">全て</option>
                            <option value="yamada">山田建設</option>
                            <option value="tanaka">田中不動産</option>
                            <option value="sato">佐藤ハウジング</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">ステータス</label>
                        <select class="filter-select" onchange="applyFilter()">
                            <option value="">全て</option>
                            <option value="open">未解決</option>
                            <option value="inprogress">対応中</option>
                            <option value="resolved">解決済み</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">期間</label>
                        <select class="filter-select" onchange="applyFilter()">
                            <option value="today">今日</option>
                            <option value="week">過去7日</option>
                            <option value="month" selected>過去30日</option>
                            <option value="all">全期間</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 優先対応が必要な案件 -->
            <div class="data-table">
                <div class="table-header">
                    <h3 class="table-title">🚨 優先対応が必要な案件</h3>
                    <div>
                        <button class="btn btn-secondary btn-sm" onclick="bulkAssign()">一括割当</button>
                        <button class="btn btn-danger btn-sm" onclick="escalateIssues()">エスカレーション</button>
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>送客ID</th>
                            <th>問題種別</th>
                            <th>重要度</th>
                            <th>企業</th>
                            <th>発生日時</th>
                            <th>経過時間</th>
                            <th>担当者</th>
                            <th>ステータス</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="critical">
                            <td style="font-weight: 600;">REF-089</td>
                            <td>データ整合性</td>
                            <td><span class="priority-badge priority-urgent">緊急</span></td>
                            <td>山田建設</td>
                            <td>
                                <div>2025-08-28</div>
                                <div style="font-size: 11px; color: #7a7a7a;">10:28</div>
                            </td>
                            <td style="color: #666666; font-weight: 600;">2分</td>
                            <td>未割当</td>
                            <td><span class="status-badge status-critical">重大</span></td>
                            <td>
                                <button class="btn btn-primary btn-sm" onclick="assignIssue('REF-089')">割当</button>
                                <button class="btn btn-danger btn-sm" onclick="viewIssue('REF-089')">詳細</button>
                            </td>
                        </tr>

                        <tr class="critical">
                            <td style="font-weight: 600;">REF-067</td>
                            <td>期限超過</td>
                            <td><span class="priority-badge priority-urgent">緊急</span></td>
                            <td>田中不動産</td>
                            <td>
                                <div>2025-08-20</div>
                                <div style="font-size: 11px; color: #7a7a7a;">14:00</div>
                            </td>
                            <td style="color: #666666; font-weight: 600;">8日</td>
                            <td>田中管理者</td>
                            <td><span class="status-badge status-critical">期限超過</span></td>
                            <td>
                                <button class="btn btn-warning btn-sm" onclick="extendDeadline('REF-067')">期限延長</button>
                                <button class="btn btn-danger btn-sm" onclick="escalateCase('REF-067')">エスカレート</button>
                            </td>
                        </tr>

                        <tr class="critical">
                            <td style="font-weight: 600;">REF-034</td>
                            <td>承認却下</td>
                            <td><span class="priority-badge priority-high">高</span></td>
                            <td>佐藤ハウジング</td>
                            <td>
                                <div>2025-08-25</div>
                                <div style="font-size: 11px; color: #7a7a7a;">16:20</div>
                            </td>
                            <td style="color: #666666; font-weight: 600;">3日</td>
                            <td>山田管理者</td>
                            <td><span class="status-badge status-critical">3回却下</span></td>
                            <td>
                                <button class="btn btn-primary btn-sm" onclick="reviewCase('REF-034')">再審査</button>
                                <button class="btn btn-danger btn-sm" onclick="escalateCase('REF-034')">エスカレート</button>
                            </td>
                        </tr>

                        <tr class="warning">
                            <td style="font-weight: 600;">REF-078</td>
                            <td>修正要求</td>
                            <td><span class="priority-badge priority-medium">中</span></td>
                            <td>鈴木工務店</td>
                            <td>
                                <div>2025-08-26</div>
                                <div style="font-size: 11px; color: #7a7a7a;">11:15</div>
                            </td>
                            <td style="color: #777777;">2日</td>
                            <td>佐藤管理者</td>
                            <td><span class="status-badge status-warning">修正待ち</span></td>
                            <td>
                                <button class="btn btn-secondary btn-sm" onclick="sendReminder('REF-078')">催促</button>
                                <button class="btn btn-primary btn-sm" onclick="viewProgress('REF-078')">進捗確認</button>
                            </td>
                        </tr>

                        <tr class="warning">
                            <td style="font-weight: 600;">REF-101</td>
                            <td>書類不備</td>
                            <td><span class="priority-badge priority-medium">中</span></td>
                            <td>高橋建設</td>
                            <td>
                                <div>2025-08-27</div>
                                <div style="font-size: 11px; color: #7a7a7a;">09:30</div>
                            </div>
                            <td style="color: #777777;">1日</td>
                            <td>田中管理者</td>
                            <td><span class="status-badge status-warning">対応中</span></td>
                            <td>
                                <button class="btn btn-primary btn-sm" onclick="checkDocuments('REF-101')">書類確認</button>
                                <button class="btn btn-secondary btn-sm" onclick="contactCompany('REF-101')">企業連絡</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- アラート設定モーダル -->
    <div id="alertConfigModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">アラート設定</h3>
                <button class="close" onclick="closeModal('alertConfigModal')">&times;</button>
            </div>
            <div class="modal-body">
                <h4 style="margin-bottom: 15px;">重大問題のアラート</h4>
                <label style="display: flex; align-items: center; margin-bottom: 10px;">
                    <input type="checkbox" checked style="margin-right: 10px;">
                    リアルタイム通知（即座に通知）
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 10px;">
                    <input type="checkbox" checked style="margin-right: 10px;">
                    メール通知（管理者全員）
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 20px;">
                    <input type="checkbox" style="margin-right: 10px;">
                    SMS通知（緊急時のみ）
                </label>

                <h4 style="margin-bottom: 15px;">期限超過アラート</h4>
                <label style="display: flex; align-items: center; margin-bottom: 10px;">
                    <input type="checkbox" checked style="margin-right: 10px;">
                    期限24時間前に警告
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 10px;">
                    <input type="checkbox" checked style="margin-right: 10px;">
                    期限超過時に即座に通知
                </label>
                <label style="display: flex; align-items: center; margin-bottom: 20px;">
                    <input type="checkbox" style="margin-right: 10px;">
                    期限超過後の定期催促（毎日）
                </label>

                <h4 style="margin-bottom: 15px;">通知設定</h4>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px;">営業時間</label>
                    <select style="width: 100%; padding: 8px; border: 1px solid #c0c0c0; border-radius: 4px;">
                        <option>9:00 - 18:00</option>
                        <option>24時間</option>
                        <option>カスタム設定</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px;">通知頻度制限</label>
                    <select style="width: 100%; padding: 8px; border: 1px solid #c0c0c0; border-radius: 4px;">
                        <option>制限なし</option>
                        <option>同一問題は1時間に1回まで</option>
                        <option>同一問題は1日1回まで</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('alertConfigModal')">キャンセル</button>
                <button class="btn btn-primary" onclick="saveAlertConfig()">設定保存</button>
            </div>
        </div>
    </div>

    <script>
        // 自動更新機能
        let autoRefreshInterval;
        
        function startAutoRefresh() {
            autoRefreshInterval = setInterval(() => {
                updateMetrics();
                updateActivityFeed();
                updateTable();
            }, 30000); // 30秒毎
        }

        function updateMetrics() {
            // メトリクスデータの更新をシミュレート
            console.log('メトリクス更新中...');
        }

        function updateActivityFeed() {
            // 活動フィードの更新をシミュレート
            console.log('活動フィード更新中...');
        }

        function updateTable() {
            // テーブルデータの更新をシミュレート
            console.log('テーブル更新中...');
        }

        // 重大問題の詳細表示
        function viewCriticalIssues() {
            window.location.href = 'exception_approval_rejection.html?tab=critical';
        }

        // アラート設定
        function configureAlerts() {
            document.getElementById('alertConfigModal').classList.add('show');
        }

        function saveAlertConfig() {
            alert('アラート設定を保存しました。');
            closeModal('alertConfigModal');
        }

        // 案件操作
        function assignIssue(referralId) {
            const assignee = prompt('担当者を選択してください:');
            if (assignee) {
                alert(`${referralId}を${assignee}に割り当てました。`);
            }
        }

        function viewIssue(referralId) {
            window.location.href = `exception_data_integrity.html?issue=${referralId}`;
        }

        function escalateCase(referralId) {
            if (confirm(`${referralId}をエスカレーションしますか？\n上位管理者に通知されます。`)) {
                alert('エスカレーションしました。');
            }
        }

        function extendDeadline(referralId) {
            const newDeadline = prompt('新しい期限を入力してください（YYYY-MM-DD）:');
            if (newDeadline) {
                alert(`${referralId}の期限を${newDeadline}まで延長しました。`);
            }
        }

        function sendReminder(referralId) {
            if (confirm(`${referralId}の修正催促を送信しますか？`)) {
                alert('催促通知を送信しました。');
            }
        }

        // 一括操作
        function bulkAssign() {
            alert('一括割当画面を開きます。');
        }

        function escalateIssues() {
            if (confirm('重大問題を一括エスカレーションしますか？')) {
                alert('一括エスカレーションを実行しました。');
            }
        }

        // フィルター適用
        function applyFilter() {
            console.log('フィルターを適用中...');
            // 実際の実装では、フィルター条件に基づいてテーブルを更新
        }

        // チャート更新
        function refreshChart() {
            alert('チャートデータを更新中...');
        }

        // レポート出力
        function exportDashboardReport() {
            alert('監視ダッシュボードレポートを出力します。\n- 例外ケース統計\n- 処理状況サマリー\n- 傾向分析');
        }

        // モーダル操作
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // モーダル外クリックで閉じる
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('show');
            }
        }

        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            startAutoRefresh();
        });

        // ページ離脱時のクリーンアップ
        window.addEventListener('beforeunload', function() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
</body>
</html>