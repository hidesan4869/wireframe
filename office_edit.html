<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>営業所編集 - 不動産ポータル管理画面</title>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f9f9f9;
            color: #2c2c2c;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* ヘッダー */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #2c2c2c;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* メインコンテンツ */
        .main-content {
            flex: 1;
            margin-top: 60px;
            padding: 20px;
            overflow-y: auto;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .breadcrumb {
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
            font-size: 14px;
            color: #6a6a6a;
        }

        .breadcrumb a {
            color: #6a6a6a;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            color: #4a4a4a;
        }

        /* プログレスバー */
        .progress-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .progress-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c2c2c;
        }

        .step-counter {
            font-size: 14px;
            color: #6a6a6a;
        }

        .progress-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .step-indicator.active {
            background: #4a4a4a;
            color: white;
        }

        .step-indicator.completed {
            background: #2e7d32;
            color: white;
        }

        .step-indicator.pending {
            background: #e0e0e0;
            color: #6a6a6a;
        }

        .step-line {
            flex: 1;
            height: 2px;
            background: #e0e0e0;
            position: relative;
        }

        .step-line.completed {
            background: #2e7d32;
        }

        .step-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .step-label {
            font-size: 12px;
            color: #6a6a6a;
            text-align: center;
            flex: 1;
        }

        .step-label.active {
            color: #4a4a4a;
            font-weight: 600;
        }

        .step-label.completed {
            color: #2e7d32;
        }

        /* フォームカード */
        .form-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        .step-title {
            font-size: 24px;
            font-weight: 600;
            color: #2c2c2c;
            margin-bottom: 8px;
        }

        .step-description {
            color: #6a6a6a;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: span 2;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: #4a4a4a;
            margin-bottom: 5px;
        }

        .form-label.required::after {
            content: " *";
            color: #d32f2f;
            font-weight: bold;
        }

        .form-input, .form-select, .form-textarea {
            padding: 12px;
            border: 1px solid #c0c0c0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #4a4a4a;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* 画像アップロード */
        .image-upload-area {
            border: 2px dashed #c0c0c0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #fafafa;
            margin-bottom: 15px;
        }

        .image-upload-area:hover {
            border-color: #4a4a4a;
            background: #f0f0f0;
        }

        .upload-text {
            color: #6a6a6a;
            margin-top: 10px;
        }

        /* 画像管理（model_house_edit.htmlベース） */
        .image-item {
            background: #fafafa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
        }

        .image-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .image-item-title {
            font-weight: 600;
            color: #2c2c2c;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .remove-image-item {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .file-upload-area {
            border: 2px dashed #6c757d;
            border-radius: 8px;
            padding: 30px 20px;
            text-align: center;
            background-color: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: #2c2c2c;
            background-color: #e9ecef;
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            color: #6c757d;
            margin-bottom: 15px;
        }

        .upload-text {
            color: #6c757d;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .upload-btn {
            background-color: #2c2c2c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .upload-btn:hover {
            background-color: #1a1a1a;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-col {
            flex: 1;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #c0c0c0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #4a4a4a;
        }

        /* ギャラリーモーダル */
        .gallery-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 3000;
            overflow: hidden;
        }

        .gallery-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gallery-container {
            position: relative;
            width: 90%;
            height: 90%;
            max-width: 1200px;
            background: white;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .gallery-header {
            padding: 20px 30px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #2c2c2c;
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .gallery-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-gallery {
            background: transparent;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .close-gallery:hover {
            background: rgba(255,255,255,0.1);
        }

        .gallery-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f5f5f5;
        }

        .gallery-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 8px 16px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            color: #6a6a6a;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .category-btn.active {
            background: #4a4a4a;
            color: white;
            border-color: #4a4a4a;
        }

        .category-btn:hover {
            border-color: #4a4a4a;
            color: #4a4a4a;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .gallery-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 3px solid transparent;
            background: white;
        }

        .gallery-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .gallery-item.selected {
            border-color: #4a4a4a;
            box-shadow: 0 4px 15px rgba(74,74,74,0.3);
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-item-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .gallery-item:hover .gallery-item-overlay {
            opacity: 1;
        }

        .gallery-item.selected .gallery-item-overlay {
            opacity: 1;
        }

        .gallery-item-title {
            color: white;
            font-size: 14px;
            font-weight: 600;
            margin-top: auto;
        }

        .gallery-checkbox {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: rgba(255,255,255,0.9);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .gallery-item:hover .gallery-checkbox,
        .gallery-item.selected .gallery-checkbox {
            opacity: 1;
        }

        .gallery-footer {
            padding: 20px 30px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            border-radius: 0 0 12px 12px;
        }

        .selection-count {
            color: #6a6a6a;
            font-size: 14px;
        }

        .gallery-btn-group {
            display: flex;
            gap: 10px;
        }

        /* ボタン */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #4a4a4a;
            color: white;
        }

        .btn-primary:hover {
            background: #3a3a3a;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #8a8a8a;
            color: white;
        }

        .btn-secondary:hover {
            background: #7a7a7a;
        }

        .btn-outline {
            background: transparent;
            color: #4a4a4a;
            border: 2px solid #4a4a4a;
        }

        .btn-outline:hover {
            background: #4a4a4a;
            color: white;
        }

        /* フォームナビゲーション */
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        /* トグルスイッチ */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2e7d32;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        .toggle-description {
            font-size: 14px;
            color: #6a6a6a;
            margin-top: 8px;
            font-weight: 500;
        }

        /* 住所入力サポート */
        .address-helper {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 6px;
            font-size: 12px;
            color: #1976d2;
            margin-top: 5px;
        }

        /* プレビュー情報 */
        .preview-section {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .preview-title {
            font-size: 16px;
            font-weight: 600;
            color: #4a4a4a;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ヘッダー -->
        <header class="header">
            <h1 style="cursor: pointer;" onclick="window.location.href='index.html'">
                <i data-lucide="home" style="width: 20px; height: 20px; margin-right: 8px;"></i>
                不動産ポータル管理システム
            </h1>
            <div class="user-info">
                <span>田中 太郎さん</span>
                <button class="btn btn-secondary">ログアウト</button>
            </div>
        </header>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <div class="breadcrumb">
                <a href="index.html">ホーム</a> > 
                <a href="#">物件管理</a> > 
                <a href="office_list.html">営業所一覧</a> > 営業所編集
            </div>

            <!-- プログレス表示 -->
            <div class="progress-container">
                <div class="progress-header">
                    <h2 class="progress-title">
                        <i data-lucide="building-2" style="width: 24px; height: 24px; margin-right: 8px;"></i>
                        ○○○○営業所編集
                    </h2>
                    <div class="step-counter">ステップ <span id="currentStep">1</span> / 3</div>
                </div>
                
                <div class="progress-bar">
                    <div class="step-indicator active" id="step1-indicator">1</div>
                    <div class="step-line" id="line1"></div>
                    <div class="step-indicator pending" id="step2-indicator">2</div>
                    <div class="step-line" id="line2"></div>
                    <div class="step-indicator pending" id="step3-indicator">3</div>
                </div>
                
                <div class="step-labels">
                    <div class="step-label active">基本情報</div>
                    <div class="step-label">画像管理</div>
                    <div class="step-label">公開設定・確認</div>
                </div>
            </div>

            <!-- フォーム -->
            <div class="form-card">
                <!-- ステップ1: 基本情報 -->
                <div class="step-content active" id="step1">
                    <div class="step-title">基本情報入力</div>
                    <div class="step-description">営業所の基本的な情報を入力してください。必須項目は「*」で示されています。</div>
                    
                    <form id="officeForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">営業所名</label>
                                <input type="text" class="form-input" id="name" name="name" placeholder="例：東京本社営業所" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label required">営業所タイトル</label>
                                <input type="text" class="form-input" id="title" name="title" placeholder="例：東京都内のお客様をサポート" required>
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label class="form-label">営業所説明</label>
                            <textarea class="form-textarea" id="description" name="description" placeholder="営業所の詳細説明を入力してください..." rows="4"></textarea>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">郵便番号</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" class="form-input" id="postal_code" name="postal_code" placeholder="例：106-0032" required style="flex: 1;">
                                    <button type="button" class="btn btn-secondary" onclick="searchPostalCode()" style="white-space: nowrap;">
                                        <i data-lucide="search" style="width: 16px; height: 16px;"></i>
                                        住所検索
                                    </button>
                                </div>
                                <div class="address-helper">
                                    <i data-lucide="info" style="width: 14px; height: 14px; margin-right: 4px;"></i>
                                    ハイフンありの形式で入力し、住所検索ボタンを押してください
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label required">都道府県</label>
                                <select class="form-select" id="prefecture_id" name="prefecture_id" required>
                                    <option value="">選択してください</option>
                                    <option value="13">東京都</option>
                                    <option value="14">神奈川県</option>
                                    <option value="23">愛知県</option>
                                    <option value="27">大阪府</option>
                                    <option value="40">福岡県</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label required">住所1（市区町村・町域）</label>
                                <input type="text" class="form-input" id="address01" name="address01" placeholder="例：港区六本木" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">住所2（番地・建物名）</label>
                                <input type="text" class="form-input" id="address02" name="address02" placeholder="例：3-2-1 六本木ヒルズ">
                            </div>
                        </div>

                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">アクセス情報</label>
                                <input type="text" class="form-input" id="access" name="access" placeholder="例：日比谷線六本木駅から徒歩3分">
                            </div>

                            <div class="form-group">
                                <label class="form-label">展示場名</label>
                                <input type="text" class="form-input" id="exhibition_venue_name" name="exhibition_venue_name" placeholder="例：六本木展示場">
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label class="form-label">営業時間</label>
                            <input type="text" class="form-input" id="business_hours" name="business_hours" placeholder="例：平日10:00～18:00">
                        </div>
                    </form>
                </div>

                <!-- ステップ2: 画像管理 -->
                <div class="step-content" id="step2">
                    <div class="step-title">画像管理</div>
                    <div class="step-description">営業所の画像を登録してください。画像にはタイトルと説明を設定できます。</div>
                    
                    <div id="imageItemsContainer">
                        <!-- 初期画像アイテム -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button type="button" class="btn btn-secondary" onclick="addImageItem()">
                            <i data-lucide="plus" style="width: 16px; height: 16px;"></i>
                            画像を追加
                        </button>
                    </div>
                </div>

                <!-- ステップ3: 確認・登録 -->
                <div class="step-content" id="step3">
                    <div class="step-title">公開設定・登録内容の確認</div>
                    <div class="step-description">公開設定を選択し、入力内容を確認して、問題なければ登録ボタンを押してください。</div>
                    
                    <div class="form-group full-width" style="margin-bottom: 30px;">
                        <label class="form-label">公開設定</label>
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="is_active" name="is_active" checked>
                                <span class="slider"></span>
                            </label>
                            <div>
                                <div style="font-weight: 600;">この営業所を公開する</div>
                                <div class="toggle-description">オンにすると営業所がWebサイトに表示されます</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- フォームナビゲーション -->
                <div class="form-navigation">
                    <div>
                        <button type="button" class="btn btn-outline" id="prevBtn" onclick="previousStep()" style="display: none;">
                            <i data-lucide="chevron-left"></i>前へ
                        </button>
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                            <i data-lucide="save"></i>下書き保存
                        </button>
                        <button type="button" class="btn btn-outline" onclick="showPreviewModal()">
                            <i data-lucide="eye"></i>プレビュー表示
                        </button>
                        <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                            次へ<i data-lucide="chevron-right"></i>
                        </button>
                        <button type="button" class="btn btn-primary" id="submitBtn" onclick="submitOffice()" style="display: none;">
                            <i data-lucide="check"></i>登録する
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ギャラリーモーダル -->
    <div id="galleryModal" class="gallery-modal">
        <div class="gallery-container">
            <div class="gallery-header">
                <div class="gallery-title">
                    <i data-lucide="image" style="width: 24px; height: 24px;"></i>
                    画像ギャラリー
                </div>
                <div class="gallery-actions">
                    <button class="close-gallery" onclick="closeGalleryModal()">×</button>
                </div>
            </div>
            <div class="gallery-body">
                <div class="gallery-categories">
                    <button class="category-btn active" data-category="all" onclick="filterGalleryByCategory('all')">すべて</button>
                    <button class="category-btn" data-category="office_image" onclick="filterGalleryByCategory('office_image')">営業所画像</button>
                </div>
                <div class="gallery-grid" id="galleryGrid">
                    <!-- ギャラリー画像がここに表示されます -->
                </div>
            </div>
            <div class="gallery-footer">
                <div class="selection-count">
                    選択中: <span id="selectedCount">0</span>枚
                </div>
                <div class="gallery-btn-group">
                    <button class="btn btn-secondary" onclick="closeGalleryModal()">キャンセル</button>
                    <button class="btn btn-primary" onclick="confirmGallerySelection()">選択完了</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStepNumber = 1;
        let uploadedImages = [];

        // ステップ進行
        function nextStep() {
            if (currentStepNumber < 3) {
                currentStepNumber++;
                updateStep();
            }
        }

        function previousStep() {
            if (currentStepNumber > 1) {
                currentStepNumber--;
                updateStep();
            }
        }

        function updateStep() {
            // ステップ表示の更新
            document.getElementById('currentStep').textContent = currentStepNumber;
            
            // コンテンツの表示切り替え
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`step${currentStepNumber}`).classList.add('active');
            
            // インジケーターの更新
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`step${i}-indicator`);
                const label = document.querySelectorAll('.step-label')[i-1];
                
                if (i < currentStepNumber) {
                    indicator.className = 'step-indicator completed';
                    label.className = 'step-label completed';
                } else if (i === currentStepNumber) {
                    indicator.className = 'step-indicator active';
                    label.className = 'step-label active';
                } else {
                    indicator.className = 'step-indicator pending';
                    label.className = 'step-label';
                }
            }
            
            // ライン表示の更新
            for (let i = 1; i <= 2; i++) {
                const line = document.getElementById(`line${i}`);
                if (currentStepNumber > i) {
                    line.className = 'step-line completed';
                } else {
                    line.className = 'step-line';
                }
            }
            
            // ボタンの表示制御
            document.getElementById('prevBtn').style.display = currentStepNumber === 1 ? 'none' : 'inline-flex';
            document.getElementById('nextBtn').style.display = currentStepNumber === 3 ? 'none' : 'inline-flex';
            document.getElementById('submitBtn').style.display = currentStepNumber === 3 ? 'inline-flex' : 'none';
            
            // ステップ3の場合はプレビューを更新
            if (currentStepNumber === 3) {
                updatePreview();
            }
        }

        // バリデーション
        function validateCurrentStep() {
            return true;
        }

        let imageItemCounter = 0;

        // 画像アイテム追加
        function addImageItem() {
            imageItemCounter++;
            const container = document.getElementById('imageItemsContainer');
            const imageItem = document.createElement('div');
            imageItem.className = 'image-item';
            imageItem.id = `imageItem_${imageItemCounter}`;
            
            imageItem.innerHTML = `
                <div class="image-item-header">
                    <div class="image-item-title">営業所画像 ${imageItemCounter}</div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 12px; color: #6a6a6a;">表示</span>
                            <label class="toggle-switch" style="transform: scale(0.8);">
                                <input type="checkbox" name="image_is_active[]" value="1" checked>
                                <span class="slider"></span>
                            </label>
                            <span class="image-display-label" style="font-size: 12px; color: #2e7d32; font-weight: 600;">ON</span>
                        </div>
                        <button type="button" class="remove-image-item" onclick="removeImageItem(${imageItemCounter})">
                            <i data-lucide="trash"></i>削除
                        </button>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>画像ファイル</label>
                            <div class="file-upload-area" onclick="openGalleryModal('office_image', 'imageFile_${imageItemCounter}')" id="uploadArea_${imageItemCounter}">
                                <i data-lucide="image" class="upload-icon"></i>
                                <div class="upload-text">ギャラリーから画像を選択</div>
                                <div style="font-size: 12px; color: #6c757d; margin-bottom: 10px;">クリックして画像を選択してください</div>
                                <input type="hidden" id="imageFile_${imageItemCounter}" name="image_paths[]">
                                <button type="button" class="upload-btn">画像を選択</button>
                            </div>
                            <div class="image-preview-container" id="imagePreview_${imageItemCounter}"></div>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="image_title_${imageItemCounter}">画像タイトル</label>
                            <input type="text" id="image_title_${imageItemCounter}" class="form-control" name="image_titles[]" placeholder="営業所外観">
                        </div>
                        <div class="form-group">
                            <label for="image_description_${imageItemCounter}">画像説明</label>
                            <textarea id="image_description_${imageItemCounter}" class="form-control" name="image_descriptions[]" rows="4" placeholder="この画像の詳細な説明を記入してください..." style="resize: vertical;"></textarea>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(imageItem);
            lucide.createIcons(); // アイコンを再初期化
        }

        // ギャラリー関連の変数
        let currentGalleryTarget = null;
        let selectedGalleryImages = [];

        // サンプル画像データ
        const galleryImages = [
            {
                id: 1,
                title: "営業所外観",
                url: "https://via.placeholder.com/300x200/4a90e2/ffffff?text=営業所外観1",
                category: "office_image"
            },
            {
                id: 2,
                title: "営業所内装",
                url: "https://via.placeholder.com/300x200/50c878/ffffff?text=営業所内装1",
                category: "office_image"
            },
            {
                id: 3,
                title: "受付エリア",
                url: "https://via.placeholder.com/300x200/f39c12/ffffff?text=受付エリア",
                category: "office_image"
            },
            {
                id: 4,
                title: "会議室",
                url: "https://via.placeholder.com/300x200/e74c3c/ffffff?text=会議室",
                category: "office_image"
            },
            {
                id: 5,
                title: "展示場",
                url: "https://via.placeholder.com/300x200/9b59b6/ffffff?text=展示場",
                category: "office_image"
            },
            {
                id: 6,
                title: "駐車場",
                url: "https://via.placeholder.com/300x200/2c3e50/ffffff?text=駐車場",
                category: "office_image"
            }
        ];

        // ギャラリーモーダルを開く
        function openGalleryModal(category, targetInputId) {
            currentGalleryTarget = targetInputId;
            selectedGalleryImages = [];
            
            const modal = document.getElementById('galleryModal');
            modal.classList.add('active');
            
            // カテゴリを初期選択
            filterGalleryByCategory(category);
            
            updateSelectedCount();
            lucide.createIcons();
        }

        // ギャラリーモーダルを閉じる
        function closeGalleryModal() {
            const modal = document.getElementById('galleryModal');
            modal.classList.remove('active');
            currentGalleryTarget = null;
            selectedGalleryImages = [];
        }

        // カテゴリでギャラリーをフィルタリング
        function filterGalleryByCategory(category) {
            // カテゴリボタンの状態更新
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.querySelector(`[data-category="${category}"]`);
            if (activeBtn) activeBtn.classList.add('active');
            
            // 画像をフィルタリング
            const filteredImages = category === 'all' ? galleryImages : 
                galleryImages.filter(img => img.category === category);
            
            // ギャラリーグリッドに表示
            const galleryGrid = document.getElementById('galleryGrid');
            galleryGrid.innerHTML = '';
            
            filteredImages.forEach(image => {
                const imageItem = document.createElement('div');
                imageItem.className = 'gallery-item';
                imageItem.innerHTML = `
                    <img src="${image.url}" alt="${image.title}">
                    <div class="gallery-item-overlay">
                        <div class="gallery-checkbox">
                            <i data-lucide="check" style="width: 14px; height: 14px; color: #4a4a4a; display: none;"></i>
                        </div>
                        <div class="gallery-item-title">${image.title}</div>
                    </div>
                `;
                
                imageItem.addEventListener('click', function() {
                    toggleGalleryImageSelection(image, imageItem);
                });
                
                galleryGrid.appendChild(imageItem);
            });
            
            lucide.createIcons();
        }

        // ギャラリー画像の選択切り替え
        function toggleGalleryImageSelection(image, element) {
            const isSelected = element.classList.contains('selected');
            
            if (isSelected) {
                // 選択解除
                element.classList.remove('selected');
                element.querySelector('.gallery-checkbox i').style.display = 'none';
                selectedGalleryImages = selectedGalleryImages.filter(img => img.id !== image.id);
            } else {
                // 単一選択のみ許可
                selectedGalleryImages = [image];
                // 他の選択を解除
                document.querySelectorAll('.gallery-item.selected').forEach(item => {
                    item.classList.remove('selected');
                    item.querySelector('.gallery-checkbox i').style.display = 'none';
                });
                
                element.classList.add('selected');
                element.querySelector('.gallery-checkbox i').style.display = 'block';
            }
            
            updateSelectedCount();
        }

        // 選択数を更新
        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedGalleryImages.length;
        }

        // ギャラリー選択を確定
        function confirmGallerySelection() {
            if (selectedGalleryImages.length === 0) {
                alert('画像を選択してください');
                return;
            }
            
            if (currentGalleryTarget) {
                const targetInput = document.getElementById(currentGalleryTarget);
                if (targetInput) {
                    // 画像パスを設定
                    targetInput.value = selectedGalleryImages[0].url;
                    
                    // プレビューを表示
                    showSelectedImagePreview(selectedGalleryImages[0], targetInput);
                }
            }
            
            closeGalleryModal();
        }

        // 選択した画像のプレビューを表示
        function showSelectedImagePreview(image, targetInput) {
            const itemId = targetInput.id.replace('imageFile_', '');
            const uploadArea = document.getElementById(`uploadArea_${itemId}`);
            const previewContainer = document.getElementById(`imagePreview_${itemId}`);
            
            // アップロードエリアを非表示にする
            uploadArea.style.display = 'none';
            
            // プレビューHTMLを作成
            previewContainer.innerHTML = `
                <div style="position: relative; margin-top: 15px;">
                    <img src="${image.url}" alt="${image.title}" style="width: 100%; height: auto; border-radius: 8px; border: 1px solid #e0e0e0;">
                    <button type="button" onclick="removeImagePreview(${itemId})" style="position: absolute; top: -10px; right: -10px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">×</button>
                    <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 12px; color: #6c757d;">
                        選択された画像: ${image.title}
                    </div>
                </div>
            `;
        }

        // 選択した画像を削除
        function removeImagePreview(itemId) {
            const uploadArea = document.getElementById(`uploadArea_${itemId}`);
            const previewContainer = document.getElementById(`imagePreview_${itemId}`);
            const input = document.getElementById(`imageFile_${itemId}`);
            
            // 入力をリセット
            input.value = '';
            
            // アップロードエリアを再表示する
            uploadArea.style.display = 'block';
            
            // プレビューをクリア
            previewContainer.innerHTML = '';
        }


        // 画像アイテム削除
        function removeImageItem(itemId) {
            const item = document.getElementById(`imageItem_${itemId}`);
            if (item) {
                item.remove();
            }
        }

        // プレビュー更新
        function updatePreview() {
            const formData = new FormData(document.getElementById('officeForm'));
            const previewContent = document.getElementById('previewContent');
            
            const name = formData.get('name') || '未入力';
            const title = formData.get('title') || '未入力';
            const description = formData.get('description') || '未入力';
            const postalCode = formData.get('postal_code') || '未入力';
            const prefectureSelect = document.getElementById('prefecture_id');
            const prefecture = prefectureSelect.options[prefectureSelect.selectedIndex].text || '未選択';
            const address01 = formData.get('address01') || '未入力';
            const address02 = formData.get('address02') || '未入力';
            const access = formData.get('access') || '未入力';
            const exhibitionVenueName = formData.get('exhibition_venue_name') || '未入力';
            const businessHours = formData.get('business_hours') || '未入力';
            const isActive = formData.get('is_active') ? '公開' : '非公開';
            
            previewContent.innerHTML = `
                <div style="display: grid; grid-template-columns: 150px 1fr; gap: 15px; font-size: 14px;">
                    <div style="font-weight: 600;">営業所名:</div>
                    <div>${name}</div>
                    
                    <div style="font-weight: 600;">タイトル:</div>
                    <div>${title}</div>
                    
                    <div style="font-weight: 600;">説明:</div>
                    <div style="word-break: break-word;">${description}</div>
                    
                    <div style="font-weight: 600;">住所:</div>
                    <div>〒${postalCode}<br>${prefecture}${address01}${address02 !== '未入力' ? ' ' + address02 : ''}</div>
                    
                    <div style="font-weight: 600;">アクセス:</div>
                    <div>${access}</div>
                    
                    <div style="font-weight: 600;">展示場名:</div>
                    <div>${exhibitionVenueName}</div>
                    
                    <div style="font-weight: 600;">営業時間:</div>
                    <div>${businessHours}</div>
                    
                    <div style="font-weight: 600;">公開状態:</div>
                    <div><span class="status-badge ${isActive === '公開' ? 'status-active' : 'status-inactive'}">${isActive}</span></div>
                    
                    <div style="font-weight: 600;">画像数:</div>
                    <div>${document.querySelectorAll('.image-item').length}枚</div>
                </div>
            `;
            
            // 画像プレビューを更新
            updateImagePreviewContent();
        }

        // 画像プレビュー更新
        function updateImagePreviewContent() {
            const imagePreviewContent = document.getElementById('imagePreviewContent');
            const imageItems = document.querySelectorAll('.image-item');
            
            if (imageItems.length === 0) {
                imagePreviewContent.innerHTML = '<div style="text-align: center; color: #6a6a6a; padding: 20px;">画像が登録されていません</div>';
                return;
            }
            
            let previewHTML = '<div style="display: grid; gap: 15px; margin-top: 15px;">';
            
            imageItems.forEach((item, index) => {
                const previewDiv = item.querySelector('[id^="imagePreview_"]');
                const titleInputs = item.querySelectorAll('input[name="image_titles[]"]');
                const descInputs = item.querySelectorAll('textarea[name="image_descriptions[]"]');
                const isActiveInput = item.querySelector('input[name="image_is_active[]"]');
                const img = item.querySelector('img');
                
                // 最初のタイトル・説明入力フィールドを使用
                const titleInput = titleInputs[0];
                const descInput = descInputs[0];
                
                const title = titleInput ? titleInput.value || '無題' : '無題';
                const description = descInput ? descInput.value || '説明なし' : '説明なし';
                const isActive = isActiveInput ? isActiveInput.checked : true;
                const hasImage = previewDiv && previewDiv.style.display === 'grid' && img && img.src;
                
                previewHTML += `
                    <div style="display: grid; grid-template-columns: 100px 1fr; gap: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e0e0e0;">
                        ${hasImage ? 
                            `<div style="width: 100px; height: 60px; border-radius: 4px; overflow: hidden;">
                                <img src="${img.src}" style="width: 100%; height: 100%; object-fit: cover;" alt="画像${index + 1}">
                            </div>` :
                            `<div style="width: 100px; height: 60px; border-radius: 4px; background: #e0e0e0; display: flex; align-items: center; justify-content: center; color: #6a6a6a; font-size: 12px;">
                                未選択
                            </div>`
                        }
                        <div>
                            <div style="font-weight: 600; margin-bottom: 5px;">${title}</div>
                            <div style="font-size: 12px; color: #6a6a6a; margin-bottom: 5px;">${description}</div>
                            <div style="font-size: 11px;">
                                <span class="status-badge ${isActive ? 'status-active' : 'status-inactive'}">
                                    ${isActive ? '表示' : '非表示'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            previewHTML += '</div>';
            imagePreviewContent.innerHTML = previewHTML;
        }

        // 下書き保存
        function saveDraft() {
            console.log('下書きを保存しました');
            alert('下書きを保存しました');
        }

        // 郵便番号検索
        function searchPostalCode() {
            const postalCode = document.getElementById('postal_code').value;
            if (!postalCode) {
                alert('郵便番号を入力してください');
                return;
            }
            
            // 郵便番号API呼び出し（モック）
            // 実際の実装では郵便番号APIを呼び出す
            const mockAddressData = {
                '106-0032': { prefecture_id: 13, address01: '港区六本木' },
                '220-0004': { prefecture_id: 14, address01: '横浜市西区北幸' },
                '460-0008': { prefecture_id: 23, address01: '名古屋市中区栄' },
                '530-0001': { prefecture_id: 27, address01: '大阪市北区梅田' },
                '810-0001': { prefecture_id: 40, address01: '福岡市中央区天神' }
            };
            
            if (mockAddressData[postalCode]) {
                const data = mockAddressData[postalCode];
                document.getElementById('prefecture_id').value = data.prefecture_id;
                document.getElementById('address01').value = data.address01;
                alert('住所情報を自動入力しました');
            } else {
                alert('該当する住所が見つかりませんでした');
            }
        }

        // 営業所編集
        function submitOffice() {
            if (confirm('この内容で営業所を登録しますか？')) {
                const formData = new FormData(document.getElementById('officeForm'));
                
                // 公開設定を追加
                formData.set('is_active', document.getElementById('is_active').checked ? 1 : 0);
                
                // 画像データも含める（ギャラリー形式）
                const imageItems = document.querySelectorAll('.image-item');
                imageItems.forEach((item, index) => {
                    const hiddenInput = item.querySelector('input[type="hidden"]');
                    const titleInputs = item.querySelectorAll('input[name="image_titles[]"]');
                    const descInputs = item.querySelectorAll('textarea[name="image_descriptions[]"]');
                    const isActiveInput = item.querySelector('input[name="image_is_active[]"]');
                    
                    // 最初のタイトル・説明入力フィールドを使用
                    const titleInput = titleInputs[0];
                    const descInput = descInputs[0];
                    
                    formData.append(`image_urls[${index}]`, hiddenInput ? hiddenInput.value : '');
                    formData.append(`image_titles[${index}]`, titleInput ? titleInput.value : '');
                    formData.append(`image_descriptions[${index}]`, descInput ? descInput.value : '');
                    formData.append(`image_is_active[${index}]`, isActiveInput ? (isActiveInput.checked ? 1 : 0) : 0);
                });
                
                console.log('営業所編集データ:', formData);
                alert('営業所の登録が完了しました！');
                window.location.href = 'office_list.html';
            }
        }

        // Lucideアイコンを初期化
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            // 初期画像アイテムを追加
            addImageItem();
        });

        // ギャラリーモーダル外クリックで閉じる
        document.getElementById('galleryModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeGalleryModal();
            }
        });

        // プレビューモーダル表示
        function showPreviewModal() {
            const modal = document.getElementById('previewModal');
            modal.classList.add('active');
            generatePreviewContent();
            lucide.createIcons();
        }

        // プレビューモーダル閉じる
        function closePreviewModal() {
            const modal = document.getElementById('previewModal');
            modal.classList.remove('active');
        }

        // デバイス切り替え
        function setDevice(device) {
            const frame = document.getElementById('previewFrame');
            const buttons = document.querySelectorAll('.device-btn');
            
            // すべてのボタンから active クラスを削除
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // 選択されたボタンに active クラスを追加
            event.target.classList.add('active');
            
            // フレームのクラスを変更
            frame.className = `preview-frame ${device}`;
        }

        // プレビュー内容生成
        function generatePreviewContent() {
            const frame = document.getElementById('previewFrame');
            const formData = new FormData(document.getElementById('wizardForm'));
            
            // フォームデータから値を取得
            const officeName = formData.get('office_name') || '営業所名未入力';
            const officeTitle = formData.get('office_title') || '営業所タイトル未入力';
            const postalCode = formData.get('postal_code') || '';
            const address = formData.get('address') || '住所未入力';
            const accessInfo = formData.get('access_info') || 'アクセス情報未入力';
            const exhibitionName = formData.get('exhibition_venue_name') || '展示場名未入力';
            const businessHours = formData.get('business_hours') || '営業時間未設定';
            const description = formData.get('description') || '営業所の説明未入力';

            let previewHTML = `
                <div class="preview-page">
                    <!-- ページヘッダー -->
                    <div class="preview-page-header">
                        <div class="office-badge">営業所</div>
                        <div class="preview-page-title">${officeName}</div>
                        <div class="preview-page-subtitle">${officeTitle}</div>
                    </div>

                    <!-- メインビジュアル -->
                    <div class="preview-main-visual">
                        <div class="placeholder-image">営業所外観画像</div>
                    </div>

                    <!-- 基本情報 -->
                    <div class="preview-content-section">
                        <h2 class="preview-section-title">
                            <i data-lucide="info" style="width: 20px; height: 20px;"></i>
                            基本情報
                        </h2>
                        <div class="preview-info-grid">
                            <div class="preview-info-item">
                                <div class="preview-info-label">所在地</div>
                                <div class="preview-info-value">${postalCode ? postalCode + ' ' : ''}${address}</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">アクセス</div>
                                <div class="preview-info-value">${accessInfo}</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">展示場名</div>
                                <div class="preview-info-value">${exhibitionName}</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">営業時間</div>
                                <div class="preview-info-value">${businessHours}</div>
                            </div>
                        </div>
                    </div>

                    <!-- 営業時間詳細 -->
                    <div class="preview-content-section">
                        <h2 class="preview-section-title">
                            <i data-lucide="clock" style="width: 20px; height: 20px;"></i>
                            営業時間
                        </h2>
                        <div class="business-hours-grid">
                            <div class="business-hours-item">
                                <div class="hours-icon">
                                    <i data-lucide="clock"></i>
                                </div>
                                <div class="hours-title">営業時間</div>
                                <div class="hours-time">${businessHours}</div>
                            </div>
                            <div class="business-hours-item">
                                <div class="hours-icon">
                                    <i data-lucide="calendar-x"></i>
                                </div>
                                <div class="hours-title">定休日</div>
                                <div class="hours-time">水曜日</div>
                            </div>
                        </div>
                    </div>

                    <!-- 営業所の説明 -->
                    <div class="preview-content-section">
                        <h2 class="preview-section-title">
                            <i data-lucide="file-text" style="width: 20px; height: 20px;"></i>
                            営業所について
                        </h2>
                        <div class="preview-description">
                            ${description}
                        </div>
                    </div>

                    <!-- 画像ギャラリー -->
                    <div class="preview-content-section">
                        <h2 class="preview-section-title">
                            <i data-lucide="images" style="width: 20px; height: 20px;"></i>
                            営業所ギャラリー
                        </h2>
                        <div class="preview-images">
                            ${generateImagePreviews()}
                        </div>
                    </div>

                    <!-- お問い合わせ -->
                    <div class="preview-content-section" style="text-align: center; padding: 60px 30px; background: #f8f9fa;">
                        <h2 style="font-size: 24px; margin-bottom: 20px; color: #2c2c2c;">お気軽にお問い合わせください</h2>
                        <p style="color: #6a6a6a; margin-bottom: 30px;">住まいづくりのご相談はお気軽にお声かけください。</p>
                        <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                            <button style="background: #2c7be5; color: white; border: none; padding: 15px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;">
                                <i data-lucide="phone" style="width: 18px; height: 18px; margin-right: 5px;"></i>
                                お電話でお問い合わせ
                            </button>
                            <button style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 6px; font-size: 16px; cursor: pointer;">
                                <i data-lucide="mail" style="width: 18px; height: 18px; margin-right: 5px;"></i>
                                メールでお問い合わせ
                            </button>
                        </div>
                    </div>
                </div>
            `;

            frame.innerHTML = previewHTML;
        }

        // 画像プレビュー生成
        function generateImagePreviews() {
            const titles = document.querySelectorAll('input[name="image_titles[]"]');
            const descriptions = document.querySelectorAll('textarea[name="image_descriptions[]"]');
            const displayToggles = document.querySelectorAll('input[name="image_is_active[]"]');
            
            let imagesHTML = '';
            for (let i = 0; i < titles.length; i++) {
                const title = titles[i]?.value || `営業所画像 ${i + 1}`;
                const description = descriptions[i]?.value || '画像の説明';
                const isActive = displayToggles[i]?.checked || false;

                if (isActive) {
                    imagesHTML += `
                        <div class="preview-image-item">
                            <div class="preview-image">
                                <span>${title}</span>
                            </div>
                            <div class="preview-image-info">
                                <div class="preview-image-title">${title}</div>
                                <div class="preview-image-description">${description}</div>
                            </div>
                        </div>
                    `;
                }
            }

            if (!imagesHTML) {
                imagesHTML = `
                    <div class="preview-image-item">
                        <div class="preview-image">
                            <span>画像が設定されていません</span>
                        </div>
                        <div class="preview-image-info">
                            <div class="preview-image-title">営業所画像</div>
                            <div class="preview-image-description">画像を追加してください</div>
                        </div>
                    </div>
                `;
            }

            return imagesHTML;
        }

        // モーダル外クリックで閉じる
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('previewModal');
            if (e.target === modal) {
                closePreviewModal();
            }
        });
    </script>

    <!-- プレビューモーダル -->
    <div id="previewModal" class="preview-modal">
        <div class="preview-container">
            <div class="preview-header">
                <div class="preview-title">
                    <i data-lucide="eye" style="width: 24px; height: 24px;"></i>
                    営業所プレビュー
                </div>
                <div class="preview-actions">
                    <div class="device-selector">
                        <button class="device-btn active" onclick="setDevice('desktop')">
                            <i data-lucide="monitor" style="width: 16px; height: 16px;"></i>
                            デスクトップ
                        </button>
                        <button class="device-btn" onclick="setDevice('tablet')">
                            <i data-lucide="tablet" style="width: 16px; height: 16px;"></i>
                            タブレット
                        </button>
                        <button class="device-btn" onclick="setDevice('mobile')">
                            <i data-lucide="smartphone" style="width: 16px; height: 16px;"></i>
                            スマートフォン
                        </button>
                    </div>
                    <button class="close-preview" onclick="closePreviewModal()">×</button>
                </div>
            </div>
            <div class="preview-body">
                <div class="preview-frame-wrapper">
                    <div id="previewFrame" class="preview-frame desktop">
                        <!-- プレビューコンテンツ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* プレビューモーダルスタイル */
        .preview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .preview-modal.active {
            display: flex;
        }

        .preview-container {
            background: white;
            width: 95%;
            max-width: 1200px;
            height: 90%;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            background: #2c2c2c;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .preview-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .device-selector {
            display: flex;
            gap: 10px;
        }

        .device-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .device-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .device-btn.active {
            background: white;
            color: #2c2c2c;
        }

        .close-preview {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .close-preview:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .preview-body {
            flex: 1;
            padding: 20px;
            background: #f5f5f5;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .preview-frame-wrapper {
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .preview-frame {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }

        .preview-frame.desktop {
            width: 100%;
            max-width: 900px;
            height: 70vh;
        }

        .preview-frame.tablet {
            width: 768px;
            height: 70vh;
        }

        .preview-frame.mobile {
            width: 375px;
            height: 70vh;
        }

        /* プレビューページ内のスタイル */
        .preview-page {
            height: 100%;
            overflow-y: auto;
            background: #ffffff;
        }

        .preview-page-header {
            background: linear-gradient(135deg, #4a4a4a 0%, #2c2c2c 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .office-badge {
            display: inline-block;
            background: #2e7d32;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .preview-page-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .preview-page-subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        .preview-main-visual {
            position: relative;
            width: 100%;
            height: 250px;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .placeholder-image {
            color: #9a9a9a;
            font-size: 18px;
            font-weight: bold;
        }

        .preview-content-section {
            padding: 30px;
            border-bottom: 1px solid #f0f0f0;
        }

        .preview-section-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c2c2c;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .preview-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .preview-info-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .preview-info-label {
            font-size: 12px;
            color: #6a6a6a;
            font-weight: 600;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .preview-info-value {
            font-size: 16px;
            color: #2c2c2c;
            font-weight: 500;
        }

        .business-hours-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .business-hours-item {
            text-align: center;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
        }

        .hours-icon {
            font-size: 24px;
            color: #2c7be5;
            margin-bottom: 15px;
        }

        .hours-title {
            font-size: 14px;
            font-weight: 600;
            color: #2c2c2c;
            margin-bottom: 8px;
        }

        .hours-time {
            font-size: 18px;
            color: #4a4a4a;
            font-weight: 500;
        }

        .preview-description {
            font-size: 16px;
            line-height: 1.6;
            color: #4a4a4a;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #2c7be5;
        }

        .preview-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .preview-image-item {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .preview-image {
            width: 100%;
            height: 150px;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9a9a9a;
            font-size: 14px;
            font-weight: bold;
        }

        .preview-image-info {
            padding: 15px;
        }

        .preview-image-title {
            font-size: 14px;
            font-weight: 600;
            color: #2c2c2c;
            margin-bottom: 5px;
        }

        .preview-image-description {
            font-size: 12px;
            color: #6a6a6a;
            line-height: 1.4;
        }

        /* レスポンシブ対応 */
        @media (max-width: 768px) {
            .preview-container {
                width: 100%;
                height: 100%;
                border-radius: 0;
            }

            .preview-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .device-selector {
                justify-content: center;
            }

            .preview-frame {
                width: 100% !important;
                height: 60vh !important;
            }

            .preview-page-header {
                padding: 30px 20px;
            }

            .preview-content-section {
                padding: 20px;
            }

            .preview-info-grid,
            .business-hours-grid,
            .preview-images {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>